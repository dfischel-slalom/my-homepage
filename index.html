<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>My Homepage</title>
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <main class="page">
      <div class="weather-visual" aria-hidden="true"></div>
      <section class="card">
        <div class="avatar-wrap">
          <!-- Use a single background-image element for more reliable hover swapping -->
          <div class="avatar-bg" role="img" aria-label="Your photo" tabindex="0"></div>
        </div>

        <h1 class="title">Hello world!</h1>
        <p class="subtitle">Welcome to my homepage.</p>

        <section class="weather" aria-live="polite">
          <div class="weather__top">
            <div class="weather__location">
              <span id="weatherLocation" class="weather__label">Seattle, WA</span>
              <div class="weather__condition-row">
                <span id="weatherIcon" class="weather__icon" aria-hidden="true">--</span>
                <span id="weatherCondition" class="weather__condition">--</span>
              </div>
            </div>
            <label class="weather__select-wrap">
              <span class="sr-only">Choose city</span>
              <select id="weatherLocationSelect" class="weather__select">
                <option value="seattle">Seattle, WA</option>
                <option value="la">Los Angeles, CA</option>
                <option value="boston">Boston, MA</option>
                <option value="waterloo">Waterloo, IA</option>
              </select>
            </label>
            <button id="weatherRefresh" class="weather__refresh" type="button">Refresh</button>
          </div>
          <div id="weatherStatus" class="weather__status">Loading current weather...</div>
          <div class="weather__metrics" id="weatherMetrics" hidden>
            <div class="weather__metric">
              <span class="weather__label">Temperature</span>
              <span id="weatherTemp" class="weather__value">--</span>
            </div>
            <div class="weather__metric">
              <span class="weather__label">Wind</span>
              <span id="weatherWind" class="weather__value">--</span>
            </div>
          </div>
        </section>

        <button id="contactBtn" class="contact">Contact me</button>
        <div id="contactModal" class="modal" hidden>
          <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
            <div class="modal__header">
              <h2 id="modalTitle" class="modal__title">Contact me</h2>
              <button id="modalClose" class="modal__close" type="button" aria-label="Close contact form">X</button>
            </div>
            <div id="contactPanel" class="contact-panel">
              <label class="panel-field"><span>Subject</span>
                <input id="panelSubject" type="text" maxlength="150" placeholder="Subject">
              </label>
              <label class="panel-field"><span>Message</span>
                <textarea id="panelMessage" rows="5" maxlength="2000" placeholder="Your message..."></textarea>
              </label>
              <div class="modal__actions">
                <button id="panelCancel" class="contact cancel" type="button">Cancel</button>
                <button id="panelSend" class="contact" type="button">Send</button>
              </div>
            </div>
          </div>
        </div>
        <div id="contactThanks" class="contact-thanks" hidden>
          Thank you! We'll get back to you shortly.
        </div>
      </section>
    </main>
    <script src="weather.js"></script>
    <script>
      // Fallback: ensure avatar swaps even if CSS hover is overridden
      (function(){
        const avatar = document.querySelector('.avatar-bg');
        if (!avatar) return;
        const imgA = 'assets/me.jpeg';
        const imgB = 'assets/me2.jpg';
        function setHover(){ avatar.style.backgroundImage = `url('${imgB}')`; avatar.style.transform = 'scale(1.02)'; }
        function setNormal(){ avatar.style.backgroundImage = `url('${imgA}')`; avatar.style.transform = 'none'; }
        avatar.addEventListener('mouseenter', setHover);
        avatar.addEventListener('mouseleave', setNormal);
        avatar.addEventListener('focus', setHover);
        avatar.addEventListener('blur', setNormal);
        // on touch/click toggle so mobile users can see the alternate photo
        avatar.addEventListener('click', function(){
          const cur = getComputedStyle(avatar).backgroundImage || '';
          if (cur.indexOf('me2.jpg') !== -1) setNormal(); else setHover();
        });
      })();

      (function(){
        const btn = document.getElementById('contactBtn');
        const modal = document.getElementById('contactModal');
        const panel = document.getElementById('contactPanel');
        const send = document.getElementById('panelSend');
        const cancel = document.getElementById('panelCancel');
        const closeBtn = document.getElementById('modalClose');
        const subj = document.getElementById('panelSubject');
        const msg = document.getElementById('panelMessage');

        if (!btn || !modal || !panel) return;

        function openModal() {
          modal.hidden = false;
          modal.classList.add('is-visible');
          subj.focus();
        }

        function closeModal() {
          modal.classList.remove('is-visible');
          modal.hidden = true;
          subj.value = '';
          msg.value = '';
        }

        btn.addEventListener('click', openModal);
        cancel.addEventListener('click', closeModal);
        closeBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', function(evt){
          if (evt.target === modal) closeModal();
        });
        document.addEventListener('keydown', function(evt){
          if (evt.key === 'Escape' && !modal.hidden) closeModal();
        });

        send.addEventListener('click', function(){
          const to = 'doug.fischels@slalom.com';
          const subjectVal = (subj.value || '').trim();
          const msgVal = (msg.value || '').trim();
          if (!subjectVal || !msgVal) {
            alert('Please provide both subject and message.');
            return;
          }

          const subjectEnc = encodeURIComponent(subjectVal || '(no subject)');
          const bodyEnc = encodeURIComponent(msgVal.replace(/\\r?\\n/g, '\\r\\n'));
          const mailto = `mailto:${encodeURIComponent(to)}?subject=${subjectEnc}&body=${bodyEnc}`;

          // show a quick visual confirmation then open mail client
          closeModal();
          const thanks = document.getElementById('contactThanks');
          if (thanks) {
            thanks.hidden = false;
            setTimeout(() => { thanks.hidden = true; }, 6000);
          }
          // open the mail client
          window.location.href = mailto;
        });
      })();
    </script>
  </body>
</html>
